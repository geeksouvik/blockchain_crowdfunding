{"remainingRequest":"/media/souvik/izuku/sidestuff/development/blockchain/Crowdfunding-using-Ethereum/node_modules/babel-loader/lib/index.js!/media/souvik/izuku/sidestuff/development/blockchain/Crowdfunding-using-Ethereum/node_modules/vuetify-loader/lib/loader.js!/media/souvik/izuku/sidestuff/development/blockchain/Crowdfunding-using-Ethereum/node_modules/cache-loader/dist/cjs.js??ref--0-0!/media/souvik/izuku/sidestuff/development/blockchain/Crowdfunding-using-Ethereum/node_modules/vue-loader/lib/index.js??vue-loader-options!/media/souvik/izuku/sidestuff/development/blockchain/Crowdfunding-using-Ethereum/src/App.vue?vue&type=script&lang=js&","dependencies":[{"path":"/media/souvik/izuku/sidestuff/development/blockchain/Crowdfunding-using-Ethereum/src/App.vue","mtime":1642639687066},{"path":"/media/souvik/izuku/sidestuff/development/blockchain/Crowdfunding-using-Ethereum/node_modules/cache-loader/dist/cjs.js","mtime":1642639686294},{"path":"/media/souvik/izuku/sidestuff/development/blockchain/Crowdfunding-using-Ethereum/node_modules/babel-loader/lib/index.js","mtime":1642639686274},{"path":"/media/souvik/izuku/sidestuff/development/blockchain/Crowdfunding-using-Ethereum/node_modules/vuetify-loader/lib/loader.js","mtime":1642639686942},{"path":"/media/souvik/izuku/sidestuff/development/blockchain/Crowdfunding-using-Ethereum/node_modules/cache-loader/dist/cjs.js","mtime":1642639686294},{"path":"/media/souvik/izuku/sidestuff/development/blockchain/Crowdfunding-using-Ethereum/node_modules/vue-loader/lib/index.js","mtime":1642639686918}],"contextDependencies":[],"result":["import _parseInt from \"/media/souvik/izuku/sidestuff/development/blockchain/Crowdfunding-using-Ethereum/node_modules/@babel/runtime-corejs2/core-js/parse-int\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _slicedToArray from \"/media/souvik/izuku/sidestuff/development/blockchain/Crowdfunding-using-Ethereum/node_modules/@babel/runtime-corejs2/helpers/esm/slicedToArray\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// We import our the scripts for the smart contract instantiation, and web3\nimport crowdfundInstance from \"../contracts/crowdfundInstance\";\nimport crowdfundProject from \"../contracts/crowdfundProjectInstance\";\nimport web3 from \"../contracts/web3\";\nexport default {\n  name: \"App\",\n  data: function data() {\n    return {\n      toggle_value: false,\n      startProjectDialog: false,\n      account: null,\n      stateMap: [{\n        color: \"primary\",\n        text: \"Ongoing\"\n      }, {\n        color: \"warning\",\n        text: \"Expired\"\n      }, {\n        color: \"success\",\n        text: \"Completed\"\n      }],\n      projectData: [],\n      projectMilestoneData: [],\n      newProject: {\n        isLoading: false,\n        milestoneloading: false,\n        startMilestoneDialog: false\n      }\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    // this code snippet takes the account (wallet) that is currently active\n    web3.eth.getAccounts().then(function (accounts) {\n      var _accounts = _slicedToArray(accounts, 1);\n\n      _this.account = _accounts[0];\n\n      _this.getProjects();\n    });\n  },\n  methods: {\n    getProjects: function getProjects() {\n      var _this2 = this;\n\n      crowdfundInstance.methods.returnAllProjects().call().then(function (projects) {\n        projects.forEach(function (projectAddress) {\n          var projectInst = crowdfundProject(projectAddress);\n          projectInst.methods.getDetails().call().then(function (projectData) {\n            var projectInfo = projectData;\n            projectInfo.isLoading = false;\n            projectInfo.milestoneloading = false;\n            projectInfo.startMilestoneDialog = false;\n            console.log(projectInfo.contributers);\n            projectInfo.contract = projectInst;\n\n            _this2.projectData.push(projectInfo);\n          });\n          projectInst.methods.getMilestones().call().then(function (data) {\n            var info = data;\n\n            _this2.projectMilestoneData.push(info);\n          });\n        });\n      });\n    },\n    startProject: function startProject() {\n      var _this3 = this;\n\n      this.newProject.isLoading = true;\n      crowdfundInstance.methods.startProject(this.newProject.title, this.newProject.description, this.newProject.duration, web3.utils.toWei(this.newProject.amountGoal, \"ether\"), this.newProject.reward, web3.utils.toWei(this.newProject.milestone, \"ether\")).send({\n        from: this.account\n      }).then(function (res) {\n        var projectInfo = res.events.ProjectStarted.returnValues;\n        projectInfo.isLoading = false;\n        projectInfo.milestoneloading = false;\n        projectInfo.startMilestoneDialog = false;\n        projectInfo.currentAmount = 0;\n        projectInfo.currentState = 0;\n        projectInfo.contract = crowdfundProject(projectInfo.contractAddress);\n        _this3.startProjectDialog = false;\n        _this3.newProject = {\n          isLoading: false,\n          milestoneloading: false,\n          startMilestoneDialog: false\n        };\n        location.reload(true);\n      });\n    },\n    fundProject: function fundProject(index) {\n      var _this4 = this;\n\n      if (!this.projectData[index].fundAmount) {\n        return;\n      }\n\n      var projectContract = this.projectData[index].contract;\n      this.projectData[index].isLoading = true;\n      projectContract.methods.contribute().send({\n        from: this.account,\n        value: web3.utils.toWei(this.projectData[index].fundAmount, \"ether\"),\n        gas: 1000000\n      }).then(function (res) {\n        var newTotal = _parseInt(res.events.FundingReceived.returnValues.currentTotal, 10);\n\n        var projectGoal = _parseInt(_this4.projectData[index].goalAmount, 10);\n\n        _this4.projectData[index].currentAmount = newTotal;\n        _this4.projectData[index].isLoading = false; // Set project state to success\n\n        if (newTotal >= projectGoal) {\n          _this4.projectData[index].currentState = 2;\n        }\n\n        location.reload(true);\n      });\n    },\n    rewardProject: function rewardProject(index) {\n      var _this5 = this;\n\n      if (!this.projectData[index].rewardAmount) {\n        return;\n      }\n\n      var projectContract = this.projectData[index].contract;\n      this.projectData[index].isLoading = true;\n      projectContract.methods.donate().send({\n        from: this.account,\n        value: web3.utils.toWei(this.projectData[index].rewardAmount, \"ether\"),\n        gas: 1000000\n      }).then(function (res) {\n        _this5.projectData[index].isLoading = false;\n        location.reload(true);\n      });\n    },\n    getRefund: function getRefund(index) {\n      var _this6 = this;\n\n      this.projectData[index].isLoading = true;\n      this.projectData[index].contract.methods.getRefund().send({\n        from: this.account\n      }).then(function () {\n        _this6.projectData[index].isLoading = false;\n        location.reload(true);\n      });\n    },\n    getReward: function getReward(index) {\n      var _this7 = this;\n\n      this.projectData[index].isLoading = true;\n      this.projectData[index].contract.methods.getReward().send({\n        from: this.account,\n        gas: 1000000\n      }).then(function () {\n        _this7.projectData[index].isLoading = false;\n        location.reload(true);\n      });\n    },\n    checkProgress: function checkProgress(index) {\n      var _this8 = this;\n\n      this.projectData[index].isLoading = true;\n      this.projectData[index].contract.methods.checkIfFundingCompleteOrExpired().send({\n        from: this.account\n      }).then(function () {\n        _this8.projectData[index].isLoading = false;\n        location.reload(true);\n      });\n    },\n    updateMilestones: function updateMilestones(index) {\n      var _this9 = this;\n\n      if (!this.projectData[index].milestoneAmount) {\n        return;\n      }\n\n      this.projectData[index].milestoneloading = true;\n      this.projectData[index].contract.methods.updateMilestone(web3.utils.toWei(this.projectData[index].milestoneAmount, \"ether\"), this.projectData[index].period).send({\n        from: this.account\n      }).then(function () {\n        _this9.projectData[index].milestoneloading = false;\n        location.reload(true);\n      });\n    }\n  }\n};",{"version":3,"sources":["App.vue"],"names":[],"mappings":"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","sourcesContent":["<style scoped>\n@import \"./style.css\";\n</style>\n\n<template>\n  <v-app class=\"grey lighten-3\">\n    <v-content>\n      <v-container>\n        <v-layout text-xs-center wrap>\n          <v-flex mb-4>\n            <h1 class=\"display-2 font-weight-bold mb-3\">Crowdfunding</h1>\n            <p\n              class=\"subheading font-weight-regular\"\n            >Utilizing Ethereum for Decentralized Crowdfunding</p>\n          </v-flex>\n        </v-layout>\n\n        <v-layout row justify-center>\n          <v-dialog v-model=\"startProjectDialog\" max-width=\"600px\" persistent>\n            <v-btn slot=\"activator\" color=\"primary\" dark>Start a Project</v-btn>\n            <v-card>\n              <v-card-title>\n                <span class=\"headline font-weight-bold mt-2 ml-4\">Bring your project to life</span>\n              </v-card-title>\n              <v-card-text class=\"pt-0\">\n                <v-container class=\"pt-0\" grid-list-md>\n                  <v-layout wrap>\n                    <v-flex xs12>\n                      <v-text-field label=\"Title\" persistent-hint v-model=\"newProject.title\"></v-text-field>\n                    </v-flex>\n                    <v-flex xs12>\n                      <v-textarea\n                        label=\"Description\"\n                        persistent-hint\n                        v-model=\"newProject.description\"\n                      ></v-textarea>\n                    </v-flex>\n                    <v-flex xs12>\n                      <v-text-field\n                        label=\"Amount Needed (ETH)\"\n                        type=\"number\"\n                        step=\"0.0001\"\n                        min=\"0\"\n                        v-model=\"newProject.amountGoal\"\n                      ></v-text-field>\n                    </v-flex>\n                    <v-flex xs12 sm6>\n                      <v-text-field\n                        label=\"Milestone Amount (ETH)\"\n                        type=\"number\"\n                        step=\"0.0001\"\n                        min=\"0\"\n                        v-model=\"newProject.milestone\"\n                      ></v-text-field>\n                    </v-flex>\n                    <v-flex xs12 sm6>\n                      <v-text-field\n                        label=\"Duration (in days) for Milestone\"\n                        type=\"number\"\n                        v-model=\"newProject.duration\"\n                      ></v-text-field>\n                    </v-flex>\n                    <v-flex>\n                      <v-checkbox v-model=\"newProject.reward\" color=\"success\" label=\"Equity Based\"></v-checkbox>\n                    </v-flex>\n                  </v-layout>\n                </v-container>\n              </v-card-text>\n              <v-card-actions>\n                <v-spacer></v-spacer>\n                <v-btn\n                  color=\"blue darken-1\"\n                  flat\n                  @click=\"startProjectDialog = false;\n                  newProject.isLoading = false;\"\n                >Close</v-btn>\n                <v-btn\n                  color=\"blue darken-1\"\n                  flat\n                  @click=\"startProject\"\n                  :loading=\"newProject.isLoading\"\n                >Save</v-btn>\n              </v-card-actions>\n            </v-card>\n          </v-dialog>\n        </v-layout>\n      </v-container>\n\n      <v-container grid-list-lg>\n        <div class=\"container\" v-if=\"toggle_value==false\">\n          <v-btn\n            color=\"primary\"\n            text-color=\"white\"\n            class=\"NonRewardBased\"\n            @click=\"toggle_value=false\"\n          >Other Projects</v-btn>\n          <v-btn class=\"RewardBased\" @click=\"toggle_value=true\">My Projects</v-btn>\n        </div>\n        <div class=\"container\" v-if=\"toggle_value==true\">\n          <v-btn\n            class=\"NonRewardBased\"\n            @click=\"toggle_value=false\"\n          >Other Projects</v-btn>\n          <v-btn color=\"primary\"\n            text-color=\"white\"\n            class=\"RewardBased\" \n            @click=\"toggle_value=true\">\n            My Projects</v-btn>\n        </div>\n        <h1 class=\"display-1 font-weight-bold mb-3\">Projects</h1>\n        <v-layout row wrap>\n          <v-flex v-for=\"(project, index) in projectData\" :key=\"index\" xs12>\n            <v-dialog v-model=\"project.dialog\" width=\"800\">\n              <v-card>\n                <v-card-title class=\"headline font-weight-bold\">{{ project.projectTitle }}</v-card-title>\n                <v-card-text>\n                  <b>Description :</b>\n                  {{ project.projectDesc }}\n                </v-card-text>\n                <v-card-actions>\n                  <v-spacer></v-spacer>\n                  <v-btn\n                    color=\"blue darken-1\"\n                    flat=\"flat\"\n                    @click=\"projectData[index].dialog = false\"\n                  >Close</v-btn>\n                </v-card-actions>\n              </v-card>\n            </v-dialog>\n\n            <v-hover>\n              <v-card\n                v-if=\"toggle_value ? account==project.projectStarter:account!=project.projectStarter \"\n                slot-scope=\"{ hover }\"\n                :class=\"`elevation-${hover ? 10 : 2}`\"\n              >\n                <v-card-title primary-title>\n                  <div style=\"width:100%\">\n                    <div class=\"headline font-weight-bold\">\n                      <v-chip\n                        label\n                        :color=\"stateMap[project.currentState].color\"\n                        text-color=\"white\"\n                        class=\"mt-0\"\n                      >{{ stateMap[project.currentState].text }}</v-chip>\n                      {{ project.projectTitle }}\n                      <v-dialog\n                        class=\"MilestoneDialog\"\n                        v-model=\"project.startMilestoneDialog\"\n                        max-width=\"600px\"\n                        persistent\n                      >\n                        <v-btn slot=\"activator\" color=\"primary\" dark>\n                          <v-icon>event_note</v-icon>\n                        </v-btn>\n                        <v-card>\n                          <v-card-title class=\"headline font-weight-bold\">List of Milestones</v-card-title>\n                          <v-flex v-for=\"(val, ind) in projectMilestoneData[index]\" :key=\"ind\" xs12>\n                            <v-flex style=\"margin-left:10%;\">\n                              <v-card-text\n                                v-if=\"ind==projectMilestoneData[index].length-1 && project.milestonestate && project.currentState==0\"\n                              >\n                                Milestone {{ind+1}} : {{val/ 10**18}} ETH\n                                <v-icon style=\"margin-left:30%;color:orange\" large>fast_forward</v-icon>\n                              </v-card-text>\n                              <v-card-text\n                                v-else-if=\"ind==projectMilestoneData[index].length-1  && project.currentState==1\"\n                              >\n                                Milestone {{ind+1}} : {{val/ 10**18}} ETH\n                                <v-icon style=\"margin-left:30%;color:red\" large>block</v-icon>\n                              </v-card-text>\n                              <v-card-text v-else>\n                                Milestone {{ind+1}} : {{val/ 10**18}} ETH\n                                <v-icon style=\"margin-left:30%;color:green\" large>check_circle</v-icon>\n                              </v-card-text>\n                            </v-flex>\n                          </v-flex>\n                          <v-card-actions>\n                            <v-spacer></v-spacer>\n                            <v-btn\n                              color=\"blue darken-1\"\n                              flat=\"flat\"\n                              @click=\"project.startMilestoneDialog = false\"\n                            >Close</v-btn>\n                          </v-card-actions>\n                        </v-card>\n                      </v-dialog>\n                      <v-btn\n                        class=\"CheckProgress\"\n                        v-if=\"project.currentState==0 && account==project.projectStarter\"\n                        color=\"primary\"\n                        dark\n                        @click=\"checkProgress(index)\"\n                        :loading=\"project.isLoading\"\n                      >Check Progress</v-btn>\n                      <v-chip\n                        v-if=\"project.reward\"\n                        color=\"success\"\n                        text-color=\"white\"\n                        class=\"RewardBasedIcon\"\n                      >\n                        <v-avatar left>\n                          <v-icon>info</v-icon>\n                        </v-avatar>Equity Based\n                      </v-chip>\n                      <v-chip v-else color=\"success\" text-color=\"white\" class=\"RewardBasedIcon\">\n                        <v-avatar left>\n                          <v-icon>info</v-icon>\n                        </v-avatar>Donation Based\n                      </v-chip>\n                    </div>\n                    <br />\n                    <span>\n                      <b>Description :</b>\n                      {{ project.projectDesc.substring(0, 100) }}\n                    </span>\n                    <span v-if=\"project.projectDesc.length > 100\">\n                      ...\n                      <a @click=\"projectData[index].dialog = true\">[Show full]</a>\n                    </span>\n                    <br />\n                    <br />\n                    <span>\n                      <b>To Raise :</b>\n                      <b>{{ project.goalAmount / 10**18 }} ETH</b>\n                    </span>\n                    <span v-if=\"project.currentState == 1\">wasn't achieved before deadline</span>\n                    <span v-if=\"project.currentState == 2\">has been achieved</span>\n                    <br />\n                    <br />\n                    <span v-if=\"!project.milestonestate\">\n                      <b>Deadline :</b>\n                      <b>{{ new Date(project.deadline * 1000) }}</b>\n                    </span>\n                  </div>\n                </v-card-title>\n                <v-flex\n                  v-if=\"project.currentState == 0 && account != project.projectStarter\"\n                  class=\"d-flex ml-3\"\n                  xs12\n                  sm6\n                  md3\n                >\n                  <v-text-field\n                    label=\"Amount (in ETH)\"\n                    type=\"number\"\n                    step=\"0.0001\"\n                    min=\"0\"\n                    v-model=\"project.fundAmount\"\n                  ></v-text-field>\n                  <v-btn\n                    dark\n                    color=\"primary\"\n                    @click=\"fundProject(index)\"\n                    :loading=\"project.isLoading\"\n                  >Fund</v-btn>\n                </v-flex>\n                <div class=\"Updatemilestone\">\n                  <v-flex\n                    v-if=\"project.currentState==0 && account == project.projectStarter && !project.milestonestate\"\n                    class=\"d-flex ml-3\"\n                    xs12\n                    sm6\n                  >\n                    <v-flex>\n                      <v-text-field\n                        label=\"Milestone Amount (in ETH)\"\n                        type=\"number\"\n                        step=\"0.0001\"\n                        min=\"0\"\n                        v-model=\"project.milestoneAmount\"\n                      ></v-text-field>\n                    </v-flex>\n                    <v-flex>\n                      <v-text-field\n                        label=\"Duration (in days) for Milestone\"\n                        type=\"number\"\n                        v-model=\"project.period\"\n                      ></v-text-field>\n                    </v-flex>\n                    <v-flex xs12 sm6>\n                      <v-btn\n                        dark\n                        color=\"primary\"\n                        @click=\"updateMilestones(index)\"\n                        :loading=\"project.milestoneloading\"\n                      >Update Milestone</v-btn>\n                    </v-flex>\n                  </v-flex>\n                </div>\n                <v-flex\n                  v-if=\"project.milestonestate && project.currentState==0\"\n                  class=\"d-flex ml-3\"\n                  xs12\n                >\n                  <v-flex v-if=\"!project.milestonestate\" sm6>\n                    <b>Milestone is has been set.Look for the list of Milestones in top right corner.</b>\n                  </v-flex>\n                  <v-flex sm6>\n                    <b>Milestone {{projectMilestoneData[index].length}} is InProgress</b>\n                  </v-flex>\n                  <v-flex sm6>\n                    <b>Deadline:</b>\n\n                    {{ new Date(project.deadline * 1000) }}\n                  </v-flex>\n                </v-flex>\n                <v-card-actions v-if=\"project.currentState == 0\" class=\"text-xs-center\">\n                  <span\n                    class=\"font-weight-bold\"\n                    style=\"width: 200px;\"\n                  >{{ project.currentAmount / 10**18 }} ETH</span>\n                  <v-progress-linear\n                    height=\"10\"\n                    :color=\"stateMap[project.currentState].color\"\n                    :value=\"(project.currentAmount / project.milestonevalue) * 100\"\n                  ></v-progress-linear>\n                  <span\n                    class=\"font-weight-bold\"\n                    style=\"width: 200px;\"\n                  >{{ project.milestonevalue / 10**18 }} ETH</span>\n                </v-card-actions>\n                <div class=\"DonateReward\">\n                  <v-flex class=\"d-flex ml-3\" xs12 sm6 md3>\n                    <v-btn\n                      dark\n                      color=\"primary\"\n                      v-if=\"project.currentState == 1 && project.contributers.includes(account) && project.reward==true && account != project.projectStarter\"\n                      @click=\"getRefund(index)\"\n                      :loading=\"project.isLoading\"\n                    >Get refund</v-btn>\n                  </v-flex>\n                  <v-flex\n                    v-if=\"project.currentState == 2 && project.contributers.includes(account) && project.reward==true && project.rewardstate && account != project.projectStarter\"\n                    v-flex\n                    class=\"d-flex ml-3\"\n                    xs12\n                    sm6\n                    md3\n                  >\n                    <v-btn\n                      dark\n                      color=\"primary\"\n                      @click=\"getReward(index)\"\n                      :loading=\"project.isLoading\"\n                    >Get Reward</v-btn>\n                  </v-flex>\n                  <v-flex\n                    v-if=\"project.currentState == 2 && project.reward==true && account == project.projectStarter\"\n                    v-flex\n                    class=\"d-flex ml-3\"\n                    xs12\n                    sm6\n                    md3\n                  >\n                    <h3\n                      v-if=\"project.rewardstate\"\n                      style=\"color:green\"\n                      class=\"ml-5\"\n                    >Reward Donated!!!</h3>\n                    <v-text-field\n                      v-if=\"!project.rewardstate\"\n                      label=\"Amount (in ETH)\"\n                      type=\"number\"\n                      step=\"0.0001\"\n                      min=\"0\"\n                      v-model=\"project.rewardAmount\"\n                    ></v-text-field>\n                    <v-btn\n                      v-if=\"!project.rewardstate\"\n                      dark\n                      color=\"primary\"\n                      @click=\"rewardProject(index)\"\n                      :loading=\"project.isLoading\"\n                    >Reward</v-btn>\n                  </v-flex>\n                </div>\n              </v-card>\n            </v-hover>\n          </v-flex>\n        </v-layout>\n      </v-container>\n    </v-content>\n  </v-app>\n</template>\n\n<script>\n// We import our the scripts for the smart contract instantiation, and web3\nimport crowdfundInstance from \"../contracts/crowdfundInstance\";\nimport crowdfundProject from \"../contracts/crowdfundProjectInstance\";\nimport web3 from \"../contracts/web3\";\n\nexport default {\n  name: \"App\",\n  data() {\n    return {\n      toggle_value: false,\n      startProjectDialog: false,\n      account: null,\n      stateMap: [\n        { color: \"primary\", text: \"Ongoing\" },\n        { color: \"warning\", text: \"Expired\" },\n        { color: \"success\", text: \"Completed\" },\n      ],\n      projectData: [],\n      projectMilestoneData: [],\n      newProject: {\n        isLoading: false,\n        milestoneloading: false,\n        startMilestoneDialog: false,\n      },\n    };\n  },\n  mounted() {\n    // this code snippet takes the account (wallet) that is currently active\n    web3.eth.getAccounts().then((accounts) => {\n      [this.account] = accounts;\n      this.getProjects();\n    });\n  },\n  methods: {\n    getProjects() {\n      crowdfundInstance.methods\n        .returnAllProjects()\n        .call()\n        .then((projects) => {\n          projects.forEach((projectAddress) => {\n            const projectInst = crowdfundProject(projectAddress);\n            projectInst.methods\n              .getDetails()\n              .call()\n              .then((projectData) => {\n                const projectInfo = projectData;\n                projectInfo.isLoading = false;\n                projectInfo.milestoneloading = false;\n                projectInfo.startMilestoneDialog = false;\n                console.log(projectInfo.contributers);\n                projectInfo.contract = projectInst;\n                this.projectData.push(projectInfo);\n              });\n            projectInst.methods\n              .getMilestones()\n              .call()\n              .then((data) => {\n                const info = data;\n                this.projectMilestoneData.push(info);\n              });\n          });\n        });\n    },\n\n    startProject() {\n      this.newProject.isLoading = true;\n      crowdfundInstance.methods\n        .startProject(\n          this.newProject.title,\n          this.newProject.description,\n          this.newProject.duration,\n          web3.utils.toWei(this.newProject.amountGoal, \"ether\"),\n          this.newProject.reward,\n          web3.utils.toWei(this.newProject.milestone, \"ether\")\n        )\n        .send({\n          from: this.account,\n        })\n        .then((res) => {\n          const projectInfo = res.events.ProjectStarted.returnValues;\n          projectInfo.isLoading = false;\n          projectInfo.milestoneloading = false;\n          projectInfo.startMilestoneDialog = false;\n          projectInfo.currentAmount = 0;\n          projectInfo.currentState = 0;\n          projectInfo.contract = crowdfundProject(projectInfo.contractAddress);\n          this.startProjectDialog = false;\n          this.newProject = {\n            isLoading: false,\n            milestoneloading: false,\n            startMilestoneDialog: false,\n          };\n          location.reload(true);\n        });\n    },\n\n    fundProject(index) {\n      if (!this.projectData[index].fundAmount) {\n        return;\n      }\n\n      const projectContract = this.projectData[index].contract;\n      this.projectData[index].isLoading = true;\n      projectContract.methods\n        .contribute()\n        .send({\n          from: this.account,\n          value: web3.utils.toWei(this.projectData[index].fundAmount, \"ether\"),\n          gas:1000000\n        })\n        .then((res) => {\n          const newTotal = parseInt(\n            res.events.FundingReceived.returnValues.currentTotal,\n            10\n          );\n          const projectGoal = parseInt(this.projectData[index].goalAmount, 10);\n          this.projectData[index].currentAmount = newTotal;\n          this.projectData[index].isLoading = false;\n\n          // Set project state to success\n          if (newTotal >= projectGoal) {\n            this.projectData[index].currentState = 2;\n          }\n          location.reload(true);\n        });\n    },\n\n    rewardProject(index) {\n      if (!this.projectData[index].rewardAmount) {\n        return;\n      }\n\n      const projectContract = this.projectData[index].contract;\n      this.projectData[index].isLoading = true;\n      projectContract.methods\n        .donate()\n        .send({\n          from: this.account,\n          value: web3.utils.toWei(\n            this.projectData[index].rewardAmount,\n            \"ether\"\n          ),\n          gas:1000000\n        })\n        .then((res) => {\n          this.projectData[index].isLoading = false;\n          location.reload(true);\n        });\n    },\n\n    getRefund(index) {\n      this.projectData[index].isLoading = true;\n      this.projectData[index].contract.methods\n        .getRefund()\n        .send({\n          from: this.account,\n        })\n        .then(() => {\n          this.projectData[index].isLoading = false;\n          location.reload(true);\n        });\n    },\n\n    getReward(index) {\n      this.projectData[index].isLoading = true;\n      this.projectData[index].contract.methods\n        .getReward()\n        .send({\n          from: this.account,\n          gas:1000000\n          })\n        .then(() => {\n          this.projectData[index].isLoading = false;\n          location.reload(true);\n        });\n    },\n\n    checkProgress(index) {\n      this.projectData[index].isLoading = true;\n      this.projectData[index].contract.methods\n        .checkIfFundingCompleteOrExpired()\n        .send({\n          from: this.account,\n        })\n        .then(() => {\n          this.projectData[index].isLoading = false;\n          location.reload(true);\n        });\n    },\n\n    updateMilestones(index) {\n      if (!this.projectData[index].milestoneAmount) {\n        return;\n      }\n      this.projectData[index].milestoneloading = true;\n      this.projectData[index].contract.methods\n        .updateMilestone(\n          web3.utils.toWei(this.projectData[index].milestoneAmount, \"ether\"),\n          this.projectData[index].period\n        )\n        .send({\n          from: this.account,\n        })\n        .then(() => {\n          this.projectData[index].milestoneloading = false;\n          location.reload(true);\n        });\n    },\n  },\n};\n</script>\n"],"sourceRoot":"src"}]}